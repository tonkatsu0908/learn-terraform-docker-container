# Terraformの基本的な利用方法(Docker)

## terraformブロックについて
terraform {} ブロックには、インフラストラクチャをプロビジョニングするためにTerraformが使用する必要なプロバイダを含むTerraform設定が含まれています。各プロバイダに対して、source属性はオプションのホスト名、名前空間、およびプロバイダタイプを定義します。TerraformはデフォルトでTerraform Registryからプロバイダをインストールします。この例の設定では、dockerプロバイダのsourceは```kreuzwerker/docker```として定義されており、これは```registry.terraform.io/kreuzwerker/docker```の省略形です。

```required_providers```ブロックで定義された各プロバイダに対してバージョン制約を設定することもできます。```version```属性はオプションですが、プロバイダのバージョンが設定と互換性がないバージョンをインストールしないように制約を設けることをお勧めします。プロバイダバージョンを指定しない場合、Terraformは初期化中に最新バージョンを自動的にダウンロードします。

## プロバイダブロックについて
プロバイダブロックは、指定されたプロバイダ（この場合はdocker）を構成します。プロバイダは、Terraformがリソースを作成および管理するために使用するプラグインです。

Terraformの設定で複数のプロバイダブロックを使用して、異なるプロバイダからリソースを管理できます。異なるプロバイダを一緒に使用することも可能です。例えば、DockerのイメージIDをKubernetesサービスに渡すことができます。

## リソースブロックについて
```resource```ブロックを使用してインフラストラクチャのコンポーネントを定義します。リソースは、Dockerコンテナのような物理的または仮想的なコンポーネントである場合もあれば、Herokuアプリケーションのような論理リソースである場合もあります。

resourceブロックには、ブロックの前にリソースタイプとリソース名の2つの文字列があります。この例では、最初のリソースタイプは```docker_image```で、名前はnginxです。タイプのプレフィックスはプロバイダの名前に対応しています。この例の設定では、Terraformはdockerプロバイダを使用して```docker_image```リソースを管理します。リソースタイプとリソース名を組み合わせると、リソースの一意のIDが形成されます。例えば、DockerイメージのIDは```docker_image.nginx```です。

resourceブロックには、リソースを構成するために使用する引数が含まれます。引数には、マシンサイズ、ディスクイメージ名、またはVPC IDなどが含まれます。プロバイダのドキュメントには、各リソースの必須およびオプションの引数が記載されています。この例の設定では、```docker_container```リソースのイメージソースとしてDockerイメージを設定しています。

## インフラの構築実行
``` terraform apply ```

## 状態を確認する
``` terraform show ```

## 手動で状態を管理する
``` terraform state {subcommands} ```
### subcommands
- list: 状態内のリソースを一覧表示する
- mv: 状態内のアイテムを移動する
- pull: 現在の状態を取得し、stdoutに出力する
- push: ローカルの状態ファイルからリモートの状態を更新する
- replace-provider: 状態内のプロバイダを置き換える
- rm: 状態からインスタンスを削除する
- show: 状態内のリソースを表示する